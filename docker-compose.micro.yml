services:
  gateway:
    image: nginx:latest
    container_name: microservices-gateway
    ports:
      - "8080:80"
    volumes:
      - ./gateway/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - accounts
      - payments
      - chat
      - basement
      - resume
    networks:
      - microservices

  accounts:
    build:
      context: ./microservices/accounts
      dockerfile: Dockerfile
    container_name: accounts-service
    expose:
      - "8000"
    networks:
      - microservices
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/healthz"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s

  payments:
    build:
      context: ./microservices/payments
      dockerfile: Dockerfile
    container_name: payments-service
    expose:
      - "8000"
    networks:
      - microservices
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/healthz"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s

  chat:
    build:
      context: ./microservices/chat
      dockerfile: Dockerfile
    container_name: chat-service
    expose:
      - "8000"
    networks:
      - microservices
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/healthz"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s

  basement:
    build:
      context: ./microservices/basement
      dockerfile: Dockerfile
    container_name: basement-service
    expose:
      - "8000"
    networks:
      - microservices
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/healthz"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s

  resume:
    build:
      context: ./microservices/resume
      dockerfile: Dockerfile
    container_name: resume-service
    expose:
      - "8000"
    networks:
      - microservices
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/healthz"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s

networks:
  microservices:
    driver: bridge
